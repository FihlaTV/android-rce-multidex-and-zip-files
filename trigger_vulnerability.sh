#! /bin/sh

ANDROID_HOME=/Users/fuzion24/bin/android_sdk_home/
TMP_DIR=`mktemp -d 2>/dev/null || mktemp -d -t 'mytmpdir'`
CLASS_NAMES=`ls sources/*.java`

if [ ! -e payload.zip ]
then
  javac -Xlint -classpath $ANDROID_HOME/platforms/android-7/android.jar  $CLASS_NAMES -d $TMP_DIR && \
  dx --dex --no-strict --output=$TMP_DIR/classes.dex  $TMP_DIR/ && \
  zip -j payload.zip $TMP_DIR/classes.dex # && \
  #adb wait-for-device push $TMP_DIR/$CLASS_NAME.jar /data/local/tmp/ && \
  #adb shell mkdir /data/local/tmp/dalvik-cache && \
  #adb shell ANDROID_DATA=/data/local/tmp dalvikvm -cp /data/local/tmp/$CLASS_NAME.jar $CLASS_NAME

  rm -r ${TMP_DIR}
fi

adb shell pm clear com.outfit7.mytalkingtomfree &&
adb shell am start -n com.outfit7.mytalkingtomfree/com.outfit7.mytalkingtom.MyTalkingTomNativeActivity

sleep 15
#rm payload.zip
